local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- Wait for PlayerGui and the Admin GUI
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local AdminGui = PlayerGui:WaitForChild("AdminCommands") -- rename if yours is different

-- Only allow access to specific users
if LocalPlayer.Name ~= "UmmmOkayWhat" and LocalPlayer.Name ~= "Snatcharelli" then
    AdminGui.Enabled = true
else
    AdminGui:Destroy()
    return
end

local RarityColor = require(ReplicatedStorage.Modules.RarityColor)
local SelectedItemName = nil
local SelectedItem = nil

local function spawnItems(folder)
    local color = RarityColor.GetColor(folder.Name)

    for _, item in pairs(folder:GetChildren()) do
        local template = AdminGui.Frame.Items.Template:Clone()
        template.Name = item.Name
        template.Text = item.Name
        template.BackgroundColor3 = color

        local categoryFolder = AdminGui.Frame.Items:FindFirstChild(folder.Name)
        template.Parent = categoryFolder
        template.Visible = true

        template.MouseButton1Click:Connect(function()
            AdminGui.Frame.SelectedItem.Text = item.Name
            SelectedItemName = item.Name
            SelectedItem = item
        end)
    end
end

local function loadAllFolders()
    for _, folder in pairs(ReplicatedStorage.Loot:GetChildren()) do
        if folder.Name == "Limited Time" then
            spawnItems(folder)
        else
            for _, subfolder in pairs(folder:GetChildren()) do
                for _, subsubfolder in pairs(subfolder:GetChildren()) do
                    spawnItems(subsubfolder)
                end
            end
        end
    end
end

loadAllFolders()

-- Tab buttons
for _, button in pairs(AdminGui.Frame.ScrollingFrame:GetChildren()) do
    if button:IsA("TextButton") then
        button.MouseButton1Click:Connect(function()
            local itemsFrame = AdminGui.Frame.Items:FindFirstChild(SelectedItemName)
            if itemsFrame then
                for _, child in pairs(AdminGui.Frame.Items:GetChildren()) do
                    if child:IsA("ScrollingFrame") then
                        child.Visible = false
                    end
                end
                itemsFrame.Visible = true
            end
        end)
    end
end

-- Spawn item button
AdminGui.Frame.TextButton.MouseButton1Click:Connect(function()
    if SelectedItem then
        local playerName = AdminGui.Frame.TextBox.Text
        if playerName and Players:FindFirstChild(playerName) then
            local player = Players:FindFirstChild(playerName)
            local amountText = AdminGui.Frame.Amount.Text
            local amount = tonumber(amountText)
            if not amount then
                amount = 1
            end

            ReplicatedStorage.Events.admincommands.SpawnItem:FireServer(SelectedItem, player, amount)
        end
    end
end)
